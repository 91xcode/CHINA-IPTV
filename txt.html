<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线M3U转TXT格式工具 - 范明明</title>
    <meta name="description" content="专业在线M3U转TXT格式工具，纯前端处理，安全不偷源，保留分组信息">
    <meta name="keywords" content="m3u转txt,m3u转换,txt生成,范明明,LIVE">
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
          background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
          color: #333;
          min-height: 100vh;
          padding: 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .container {
          width: 100%;
          max-width: 1000px;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
          overflow: hidden;
          margin: 20px 0;
        }

        header {
          background: linear-gradient(90deg, #2c3e50, #4a6491);
          color: white;
          padding: 25px 30px;
          text-align: center;
          position: relative;
        }

        h1 {
          font-size: 2.5rem;
          margin-bottom: 10px;
          background: linear-gradient(45deg, #00d2ff, #3a7bd5);
          -webkit-background-clip: text;
          background-clip: text;
          color: transparent;
          text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
          font-size: 1.2rem;
          opacity: 0.9;
          margin-top: 5px;
          color: #e0e0e0;
        }

        .tool-description {
          background: #e3f2fd;
          padding: 15px 25px;
          border-bottom: 1px solid #bbdefb;
          font-size: 1.1rem;
          line-height: 1.6;
        }

        .converter-container {
          display: flex;
          flex-wrap: wrap;
          padding: 25px;
        }

        .input-section, .output-section {
          flex: 1;
          min-width: 300px;
          padding: 20px;
        }

        .input-section {
          border-right: 2px dashed #e0e0e0;
        }

        .section-title {
          font-size: 1.4rem;
          margin-bottom: 15px;
          color: #1a237e;
          display: flex;
          align-items: center;
        }

        .section-title i {
          margin-right: 10px;
          color: #3f51b5;
        }

        textarea {
          width: 100%;
          height: 300px;
          padding: 15px;
          border: 1px solid #bdbdbd;
          border-radius: 10px;
          font-family: 'Courier New', monospace;
          font-size: 14px;
          resize: vertical;
          background: #fafafa;
          box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
          transition: border 0.3s;
        }

        textarea:focus {
          border-color: #3f51b5;
          outline: none;
          box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
        }

        .options {
          margin: 20px 0;
          padding: 15px;
          background: #f5f5f5;
          border-radius: 10px;
        }

        .option-group {
          margin-bottom: 15px;
        }

        label {
          display: block;
          margin-bottom: 8px;
          font-weight: 500;
          color: #333;
        }

        input[type="text"] {
          width: 100%;
          padding: 10px 15px;
          border: 1px solid #bdbdbd;
          border-radius: 6px;
          font-size: 1rem;
        }

        .checkbox-group {
          display: flex;
          align-items: center;
        }

        .checkbox-group input {
          margin-right: 10px;
        }

        .btn-group {
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          margin-top: 20px;
        }

        .btn {
          flex: 1;
          min-width: 120px;
          padding: 12px 15px;
          font-size: 1rem;
          font-weight: 600;
          border: none;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .btn i {
          margin-right: 8px;
        }

        .btn-convert {
          background: linear-gradient(135deg, #3f51b5, #303f9f);
          color: white;
        }

        .btn-convert:hover {
          background: linear-gradient(135deg, #303f9f, #283593);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-clear {
          background: linear-gradient(135deg, #f44336, #d32f2f);
          color: white;
        }

        .btn-clear:hover {
          background: linear-gradient(135deg, #d32f2f, #b71c1c);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-copy {
          background: linear-gradient(135deg, #4caf50, #388e3c);
          color: white;
        }

        .btn-copy:hover {
          background: linear-gradient(135deg, #388e3c, #2e7d32);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-save {
          background: linear-gradient(135deg, #ff9800, #f57c00);
          color: white;
        }

        .btn-save:hover {
          background: linear-gradient(135deg, #f57c00, #ef6c00);
          transform: translateY(-2px);
          box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .stats {
          display: flex;
          justify-content: space-between;
          margin-top: 20px;
          padding: 15px;
          background: #f5f5f5;
          border-radius: 10px;
          font-size: 0.9rem;
        }

        .stat-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 0 10px;
        }

        .stat-value {
          font-size: 1.4rem;
          font-weight: 700;
          color: #3f51b5;
        }

        .stat-label {
          color: #666;
          margin-top: 5px;
        }

        footer {
          text-align: center;
          padding: 20px;
          color: rgba(255, 255, 255, 0.8);
          font-size: 0.9rem;
          width: 100%;
          max-width: 1000px;
        }

        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 8px;
          background: #4caf50;
          color: white;
          box-shadow: 0 4px 6px rgba(0,0,0,0.1);
          display: flex;
          align-items: center;
          z-index: 100;
          transform: translateX(110%);
          transition: transform 0.3s ease;
        }

        .notification.show {
          transform: translateX(0);
        }

        .notification i {
          margin-right: 10px;
          font-size: 1.2rem;
        }

        @media (max-width: 768px) {
          .converter-container {
            flex-direction: column;
          }

          .input-section {
            border-right: none;
            border-bottom: 2px dashed #e0e0e0;
            padding-bottom: 30px;
          }

          .output-section {
            padding-top: 30px;
          }

          .btn {
            min-width: 100%;
          }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div class="container">
    <header>
        <h1>在线M3U转TXT格式工具</h1>
        <div class="subtitle">纯前端处理 · 安全不偷源 · 保留分组信息</div>
    </header>

    <div class="tool-description">
        <p>此工具可将M3U格式的直播源文件转换为TXT格式。所有转换操作均在您的浏览器中完成，无需上传到服务器，保障您的源文件安全。</p>
    </div>

    <div class="converter-container">
        <div class="input-section">
            <h2 class="section-title"><i class="fas fa-file-import"></i> M3U格式输入</h2>
            <textarea id="m3uInput" placeholder="粘贴M3U格式内容或直接上传文件..."></textarea>

            <div class="options">
                <div class="option-group">
                    <label for="fileUpload">上传M3U文件:</label>
                    <input type="file" id="fileUpload" accept=".m3u">
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="keepGroups" checked>
                    <label for="keepGroups">保留分组信息</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="filterHD">
                    <label for="filterHD">仅保留高清频道</label>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-convert" onclick="convertToTXT()">
                    <i class="fas fa-exchange-alt"></i> 转换格式
                </button>
                <button class="btn btn-clear" onclick="clearScreen()">
                    <i class="fas fa-trash-alt"></i> 清除内容
                </button>
            </div>
        </div>

        <div class="output-section">
            <h2 class="section-title"><i class="fas fa-file-export"></i> TXT格式输出</h2>
            <textarea id="txtOutput" placeholder="转换结果将显示在这里..." readonly></textarea>

            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="channelCount">0</div>
                    <div class="stat-label">频道数量</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="groupCount">0</div>
                    <div class="stat-label">分组数量</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="fileSize">0KB</div>
                    <div class="stat-label">文件大小</div>
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-copy" onclick="copyContent()">
                    <i class="fas fa-copy"></i> 复制结果
                </button>
                <button class="btn btn-save" onclick="saveAsTXT()">
                    <i class="fas fa-download"></i> 保存TXT
                </button>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>© 2023 live.fanmingming.com | 安全、便捷、高效的直播源转换工具</p>
    <p>本工具纯前端处理，您的源文件不会上传到任何服务器</p>
</footer>

<div class="notification" id="notification">
    <i class="fas fa-check-circle"></i>
    <span id="notificationMessage">操作成功！</span>
</div>

<script>
    // 显示通知
    function showNotification(message, isError = false) {
      const notification = document.getElementById('notification');
      const messageEl = document.getElementById('notificationMessage');

      messageEl.textContent = message;
      notification.className = 'notification';

      if (isError) {
        notification.style.background = '#f44336';
        notification.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
      }

      notification.classList.add('show');

      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // 更新统计数据
    function updateStats(content) {
      const channelCount = document.getElementById('channelCount');
      const groupCount = document.getElementById('groupCount');
      const fileSize = document.getElementById('fileSize');

      // 计算频道数量
      const channelMatches = content.match(/#EXTINF/g) || [];
      channelCount.textContent = channelMatches.length;

      // 计算分组数量
      const groupMatches = content.match(/group-title="([^"]*)"/g) || [];
      const uniqueGroups = new Set();
      groupMatches.forEach(match => {
        const group = match.split('"')[1];
        uniqueGroups.add(group);
      });
      groupCount.textContent = uniqueGroups.size;

      // 计算文件大小
      const sizeKB = Math.round(content.length / 1024 * 100) / 100;
      fileSize.textContent = `${sizeKB}KB`;
    }

    // M3U转TXT函数
    function convertToTXT() {
      const m3uInput = document.getElementById('m3uInput').value;
      const keepGroups = document.getElementById('keepGroups').checked;
      const filterHD = document.getElementById('filterHD').checked;

      if (!m3uInput.trim()) {
        showNotification('请输入M3U内容或上传文件', true);
        return;
      }

      const lines = m3uInput.split('\n');
      let txtOutput = '';
      let currentGroup = '未分组';
      const groups = new Set();

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i].trim();
        if (line.startsWith('#EXTINF')) {
          // 解析分组信息
          const groupMatch = line.match(/group-title="([^"]*)"/);
          if (groupMatch) {
            currentGroup = groupMatch[1];
            groups.add(currentGroup);
          }

          // 解析频道名称
          const nameMatch = line.match(/,(.*)$/);
          const channelName = nameMatch ? nameMatch[1] : '未知频道';

          // 获取URL
          const url = i + 1 < lines.length ? lines[i + 1].trim() : '';

          if (url && url.length > 0) {
            // 高清频道过滤
            if (filterHD && !channelName.includes('高清') && !channelName.includes('HD')) {
              continue;
            }

            // 保留分组信息
            if (keepGroups) {
              txtOutput += `${channelName},${url}\n`;
            } else {
              txtOutput += `${channelName},${url}\n`;
            }
          }
        }
      }

      // 如果有分组信息，在顶部添加分组行
      if (keepGroups && groups.size > 0) {
        let groupHeader = '';
        groups.forEach(group => {
          groupHeader += `${group},#genre#\n`;
        });
        txtOutput = groupHeader + '\n' + txtOutput;
      }

      document.getElementById('txtOutput').value = txtOutput;
      updateStats(m3uInput);
      showNotification('转换成功！');
    }

    // 清除内容
    function clearScreen() {
      document.getElementById('m3uInput').value = '';
      document.getElementById('txtOutput').value = '';
      document.getElementById('channelCount').textContent = '0';
      document.getElementById('groupCount').textContent = '0';
      document.getElementById('fileSize').textContent = '0KB';
      showNotification('内容已清除');
    }

    // 复制结果
    function copyContent() {
      const txtOutput = document.getElementById('txtOutput');
      if (txtOutput.value) {
        txtOutput.select();
        document.execCommand('copy');
        showNotification('内容已复制到剪贴板');
      } else {
        showNotification('没有内容可复制', true);
      }
    }

    // 保存为TXT文件
    function saveAsTXT() {
      const txtContent = document.getElementById('txtOutput').value;
      if (txtContent) {
        const blob = new Blob([txtContent], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `直播源_${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification('文件已开始下载');
      } else {
        showNotification('没有内容可保存', true);
      }
    }

    // 文件上传处理
    document.getElementById('fileUpload').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('m3uInput').value = e.target.result;
        updateStats(e.target.result);
        showNotification('文件已加载');
      };
      reader.readAsText(file);
    });

    // 示例M3U内容
    document.addEventListener('DOMContentLoaded', function() {
      const exampleContent = `#EXTM3U x-tvg-url="https://example.com/epg.xml"
#EXTINF:-1 tvg-id="1" tvg-name="CCTV-1" tvg-logo="https://example.com/cctv1.png" group-title="央视",CCTV-1 综合
http://example.com/cctv1.m3u8
#EXTINF:-1 tvg-id="2" tvg-name="CCTV-2" tvg-logo="https://example.com/cctv2.png" group-title="央视",CCTV-2 财经
http://example.com/cctv2.m3u8
#EXTINF:-1 tvg-id="3" tvg-name="湖南卫视" tvg-logo="https://example.com/hunan.png" group-title="卫视",湖南卫视
http://example.com/hunan.m3u8`;

      document.getElementById('m3uInput').value = exampleContent;
      updateStats(exampleContent);
    });
</script>
</body>
</html>